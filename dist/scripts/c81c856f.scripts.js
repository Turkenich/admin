var Utils={isHeroku:document.location.host.search("herokuapp.com")>-1,findIdInArray:function(a,b,c){"undefined"==typeof c&&(c="_id");for(var d,e=0;d=a[e];e++)if(d[c]==b)return d;return!1}},Consts={OunceToGrams:28.3495,api_root:Utils.isHeroku?"http://turkenich-api.herokuapp.com/":"http://localhost:3000/"};Array.prototype.findById=function(a,b){"undefined"==typeof b&&(b="_id");for(var c,d=0;c=this[d];d++)if(c[b]==a)return c;return{}},Array.prototype.findIndexById=function(a,b){"undefined"==typeof b&&(b="_id");for(var c,d=0;c=this[d];d++)if(c[b]==a)return d;return-1},Array.prototype.findNextById=function(a,b){"undefined"==typeof b&&(b="_id");for(var c,d={},e=0;c=this[e];e++)c[b]>a&&(!d||c[b]<d[b])&&(d=c);return d},Array.prototype.findPrevById=function(a,b){"undefined"==typeof b&&(b="_id");for(var c,d={},e=0;c=this[e];e++)c[b]<a&&(!d||c[b]>d[b])&&(d=c);return d},angular.module("adminApp",["ngCookies","ngResource","ngSanitize","ngRoute","angularFileUpload","cloudinary","ui.bootstrap","ui.bootstrap.tpls","ui.bootstrap.transition"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/upload",{templateUrl:"views/partials/photo-upload.html",controller:"photoUploadCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl",reloadOnSearch:!1}).when("/orders",{templateUrl:"views/orders.html",controller:"OrdersCtrl",reloadOnSearch:!1}).when("/orders/:id",{templateUrl:"views/order.html",controller:"OrdersCtrl",reloadOnSearch:!1}).when("/models",{templateUrl:"views/models.html",controller:"ModelsCtrl",reloadOnSearch:!1}).when("/models/:id",{templateUrl:"views/model.html",controller:"ModelsCtrl",reloadOnSearch:!1}).when("/elements",{templateUrl:"views/elements.html",controller:"ElementsCtrl",reloadOnSearch:!1}).when("/elements/:id",{templateUrl:"views/element.html",controller:"ElementsCtrl",reloadOnSearch:!1}).when("/prices",{templateUrl:"views/prices.html",controller:"PricesCtrl",reloadOnSearch:!1}).when("/prices/:id",{templateUrl:"views/price.html",controller:"PricesCtrl",reloadOnSearch:!1}).when("/coatings",{templateUrl:"views/coatings.html",controller:"CoatingsCtrl"}).when("/coatings/:id",{templateUrl:"views/coating.html",controller:"CoatingsCtrl"}).when("/materials",{templateUrl:"views/materials.html",controller:"MaterialsCtrl"}).when("/materials/:id",{templateUrl:"views/material.html",controller:"MaterialsCtrl"}).when("/providers",{templateUrl:"views/providers.html",controller:"ProvidersCtrl"}).when("/providers/:id",{templateUrl:"views/provider.html",controller:"ProvidersCtrl"}).when("/elementFeatures",{templateUrl:"views/elementFeatures.html",controller:"ElementFeaturesCtrl"}).when("/elementFeatures/:id",{templateUrl:"views/elementFeature.html",controller:"ElementFeaturesCtrl"}).when("/elementTypes",{templateUrl:"views/elementTypes.html",controller:"ElementTypesCtrl"}).when("/elementTypes/:id",{templateUrl:"views/elementType.html",controller:"ElementTypesCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("adminApp").directive("jsonExplorer",["$http",function(a){return{restrict:"E",scope:{jsonData:"@"},link:function(a,b,c){c.$observe("jsonData",function(a){function c(a){var b=a.target,c=b.parentNode.getElementsByClassName("collapsible");if(c.length)if(c=c[0],"none"==c.style.display){var d=c.parentNode.getElementsByClassName("ellipsis")[0];c.parentNode.removeChild(d),c.style.display="",b.innerHTML="-"}else{c.style.display="none";var d=document.createElement("span");d.className="ellipsis",d.innerHTML=" &hellip; ",c.parentNode.insertBefore(d,c),b.innerHTML="+"}}var d={};d.jsString=function(a){var b,c={"\b":"b","\f":"f","\r":"r","\n":"n","	":"t"};for(b in c)-1===a.indexOf(b)&&delete c[b];a=JSON.stringify({a:a}),a=a.slice(6,-2);for(b in c)a=a.replace(new RegExp("\\\\u000"+b.charCodeAt().toString(16),"ig"),"\\"+c[b]);return this.htmlEncode(a)},d.htmlEncode=function(a){return null==a?"":a.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},d.decorateWithSpan=function(a,b){return'<span class="'+b+'">'+this.htmlEncode(a)+"</span>"},d.arrayToHtml=function(a){var b=!1,c="",d=0;for(var e in a)d++;for(var e in a)b=!0,c+="<li>"+this.valueToHtml(a[e]),d>1&&(c+=","),c+="</li>",d--;return c=b?'[<ul class="array collapsible">'+c+"</ul>]":"[ ]"},d.objectToHtml=function(a){var b=!1,c="",d=0;for(var e in a)d++;for(var e in a)b=!0,c+='<li><span class="prop"><span class="q">"</span>'+this.jsString(e)+'<span class="q">"</span></span>: '+this.valueToHtml(a[e]),d>1&&(c+=","),c+="</li>",d--;return c=b?'{<ul class="obj collapsible">'+c+"</ul>}":"{ }"},d.valueToHtml=function(a){var b=a&&a.constructor,c="";return null==a&&(c+=this.decorateWithSpan("null","null")),a&&b==Array&&(c+=this.arrayToHtml(a)),a&&b==Object&&(c+=this.objectToHtml(a)),b==Number&&(c+=this.decorateWithSpan(a,"num")),b==String&&(c+=/^(http|https|file):\/\/[^\s]+$/i.test(a)?'<a href="'+a+'"><span class="q">"</span>'+this.jsString(a)+'<span class="q">"</span></a>':'<span class="string">"'+this.jsString(a)+'"</span>'),b==Boolean&&(c+=this.decorateWithSpan(a,"bool")),c},d.jsonToHtml=function(a){return'<div class="gd-ui-json-explorer">'+this.valueToHtml(a)+"</div>"};var e=JSON.parse(a||"{}"),f=d.jsonToHtml(e);b.html(f);for(var g=angular.element(b)[0].getElementsByTagName("ul"),h=0;h<g.length;h++){var i=g[h];if(-1!=i.className.indexOf("collapsible")&&"LI"==i.parentNode.nodeName){var j=document.createElement("div");j.className="collapser",j.innerHTML="-",j.addEventListener("click",c,!1),i.parentNode.insertBefore(j,i.parentNode.firstChild)}}})}}}]),angular.module("adminApp").directive("dynamicInput",["$rootScope","$timeout",function(a,b){return{restrict:"E",scope:{type:"@",model:"=",item:"=",name:"@",desc:"@",options:"="},template:function(a){var b='<div class="form-group tile"><label for="{{id}}" class="control-label" title="{{desc}}">{{name}}</label>';switch(a.attr("type")){case"select":b+='<select class="form-control" id="{{id}}" ng-model="model" placeholder="{{desc}}" ng-options="option.name  for option in options track by option._id " ><option value="" selected>--------</option></select>';break;case"textarea":b+='<textarea class="form-control" id="{{id}}" ng-model="model" placeholder="{{desc}}"/>';break;case"image":b+='<input class="form-control" id="{{id}}" type="text" ng-model="model" placeholder="{{desc}}" style="height:0px; padding:0px; visibility: hidden;"/><a  ng-click="displayUploader(true);" class="thumbnail" style="margin: -15px 0 0 0;"><img ng-src="{{model || \'/images/default_image.png\'}}" alt="..."></a><image-uploader ng-if="showUploader" type="photo" enabled="true" width="640"height="480" model="model"></image-uploader>';break;default:b+='<input class="form-control" id="{{id}}" type="{{type}}" ng-model="model" placeholder="{{desc}}"/>'}return b},link:function(c,d,e){c.id=e.type+"_"+e.name.replace(/'/g,""),c.showUploader=a.showUploader,c.displayUploader=function(b){a.showUploader=b,c.showUploader=a.showUploader},c.$watch("model",function(a,e){a&&"select"==d.attr("type")&&b(function(){angular.isObject(c.model)?c.model=c.options.findById(c.model._id):c.model=c.options.findById(c.model)})})}}}]),angular.module("adminApp").directive("dynamicFilter",["$rootScope","$timeout",function(a,b){return{restrict:"E",scope:{type:"@",model:"@",name:"@",desc:"@",options:"=",range:"@"},template:function(a){var b='<div class="form-group tile {{range}}"><label for="{{id}}" class="control-label {{range}}" title="{{desc}}">{{name}}</label>';switch(a.attr("type")){case"select":b+='<select class="form-control" id="{{id}}" ng-model="filter" placeholder="{{desc}}" ng-change="updateFilter()" ng-options="option.name  for option in options track by option._id " ><option value="" selected>--------</option></select>';break;case"parent":b+='<select class="form-control" id="{{id}}" ng-model="filter" placeholder="{{desc}}" ng-change="updateFilter()" ng-options="option.name  for option in options track by option._id " ><option value="" selected>--------</option></select>';break;case"textarea":b+='<textarea class="form-control" id="{{id}}" ng-model="filter" placeholder="{{desc}}" ng-change="updateFilter()"/>';break;case"date":b+='<p class="input-group {{range}}"><input type="text" class="form-control ltr-datepicker {{range}}" datepicker-popup="dd/MM/yy" ng-model="filter" is-open="opened" close-text="Close"  ng-change="updateFilter()" /><span class="input-group-btn"><button type="button" class="btn btn-default {{range}}" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></p>';break;default:b+='<input class="form-control {{range}}" id="{{id}}" type="{{type}}" placeholder="{{desc}}" ng-model="filter" ng-change="updateFilter()"/>'}return b},link:function(b,c,d){b.id=d.model.replace(/'/g,""),b.updateFilter=function(){if("parent"==b.type){if(!b.filter)return void(a.filter._id=null);a.filter._id=JSON.parse(b.filter._id)}else{var c="";c=angular.isUndefined(b.range)?"":"_"+b.range,b.filter?a.filter[b.id+c]=b.filter:delete a.filter[b.id+c]}console.log("filter updated",a.filter)},b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0},b.$watch("options",function(a,d){a&&"select"==c.attr("type")&&angular.isDefined(b.options)&&b.options[0]&&!b.model&&(b.model=b.options[0])})}}}]),angular.module("adminApp").directive("listItem",["$rootScope","$location",function(a,b){return{restrict:"E",scope:{index:"=",item:"=",path:"@",addto:"="},templateUrl:"views/partials/listItem.html",link:function(a,b,c){if(a.removeItem=a.$parent.removeItem,a.moveItemUp=a.$parent.moveItemUp,a.moveItemDown=a.$parent.moveItemDown,a.item.image){var d=a.item.image.split("/");d[d.length-2]="w_64,h_64,c_fill",a.item.small_image=d.join("/")}else angular.isDefined(a.item.image)&&(a.item.small_image="images/noimage64.jpg");switch(a.path){case"elements":a.parentPath="models";break;case"models":a.parentPath="orders";break;default:a.parentPath=!1}a.addto?a.link="#/"+a.parentPath+"/"+a.addto+"?addId="+a.item._id:a.link="#/"+a.path+"/"+a.item._id}}}]),angular.module("adminApp").directive("imageUploader",["$rootScope","$upload","$timeout","$sce",function(a,b,c,d){return{templateUrl:"views/partials/camera.html",replace:!1,transclude:!0,restrict:"E",scope:{type:"@",width:"@",model:"@",height:"@",overlaySrc:"=",countdown:"@",enabled:"=",captureMessage:"@"},link:function(a,e,f,g){function h(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}return a.activeCountdown=!1,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,a.$on("$destroy",function(){a.stream&&"function"==typeof a.stream.stop&&a.stream.stop()}),a.enableCamera=function(){return navigator.getUserMedia({audio:!1,video:!0},function(b){return a.$apply(function(){return a.stream=b,a.isLoaded=!0,a.videoStream=d.trustAsResourceUrl(window.URL.createObjectURL(b))})},function(b){return a.$apply(function(){return a.isLoaded=!0,a.noCamera=!0})})},a.disableCamera=function(){return navigator.getUserMedia({audio:!1,video:!0},function(b){return a.$apply(function(){return a.videoStream=""})})},a.takePicture=function(){var b,d,e,f;return b=window.document.getElementById("ng-photo-canvas"),f=null!=a.countdown?1e3*parseInt(a.countdown):0,null!=b&&(f>0&&(a.activeCountdown=!0,a.hideUI=!0),d=b.getContext("2d"),a.countdownTimer&&c.cancel(a.countdownTimer),a.countdownTimer=c(function(){var c;return a.activeCountdown=!1,c=window.document.getElementById("ng-camera-feed"),d.drawImage(c,0,0,a.width,a.height),null!=a.overlaySrc?a.addFrame(d,a.overlaySrc,function(c){return a.$apply(function(){return a.media=b.toDataURL("image/jpeg")}),null!=a.captureCallback?a.captureCallback(a.media):void 0}):(a.media=b.toDataURL("image/jpeg"),null!=a.captureCallback&&a.captureCallback(a.media)),a.hideUI=!1},f+1e3),a.countdownText=parseInt(a.countdown),e=setInterval(function(){return a.$apply(function(){var b;return b=parseInt(a.countdownText)-1,0===b?(a.countdownText=null!=a.captureMessage?a.captureMessage:"GO!",clearInterval(e)):a.countdownText=b})},1e3)),!1},a.addFrame=function(b,c,d){var e;return null==d&&(d=!1),e=new Image,e.onload=function(){return b.drawImage(e,0,0,a.width,a.height),d?d(b):void 0},e.crossOrigin="",e.src=c},a.$watch("media",function(b){return null!=b?a.packagedMedia=a.media.replace(/^data:image\/\w+;base64,/,""):void 0}),a.$watch("overlaySrc",function(b,c){var d;return null!=a.overlaySrc?(a.isLoaded=!1,d=new Image,d.crossOrigin="",d.src=b,d.onload=function(){return a.$apply(function(){return a.isLoaded=!0})}):a.isLoaded=!0}),a.$watch("enabled",function(b,c){if(b){if(!c)return a.enableCamera()}else if(null!=c)return a.disableCamera()}),a.uploading={},a.uploadedImage=a.$parent.item.image,a.retakePicture=function(){a.uploadedImage=""},a.captureCallback=function(d){if(d){var e=h(d);a.upload=b.upload({url:"https://api.cloudinary.com/v1_1/"+$.cloudinary.config().cloud_name+"/upload",data:{upload_preset:$.cloudinary.config().upload_preset},file:e}).progress(function(b){a.uploading.progress=Math.round(100*b.loaded/b.total),a.uploading.status="Uploading... "+e.progress+"%"}).success(function(b,d,e,f){console.log("uploaded!!!",b),a.uploadedImage=b.url,a.$parent.item.image=b.url,c(function(){a.close()},1e3)})}},a.close=function(){a.$parent.displayUploader(!1)},a.$watch("type",function(){switch(a.type){case"photo":if(a.enabled)return a.enableCamera();break;default:if(a.enabled)return a.enableCamera()}})}}}]),angular.module("adminApp").controller("RootCtrl",["$rootScope","$scope","$sce","$timeout","$window","$location","ElementTypes","Materials","Coatings","ElementFeatures","Providers","Prices",function(a,b,c,d,e,f,g,h,i,j,k,l){console.log("VERSION: 1.0"),b.updateBreadcrumbs=function(b,c,d){a.breadcrumbs=[{name:"ראשי",link:"#/"}],b&&c&&(a.breadcrumbs.push({name:b,link:"#/"+c}),d&&a.breadcrumbs.push({name:d.code||d.name||d.desc,link:"#/"+c+"/"+d._id}))},b.updateBreadcrumbs(),b.goBack=function(a){d(function(){var a=f.path().split("/");a.splice(a.length-1,1),f.path(a.join("/"))},a||0)},b.trustUrl=function(a){return c.trustAsResourceUrl(a)},a.reloadItemImp=function(a,b,c,d){c&&c._id?a.item=b.query({id:c._id},function(){angular.isFunction(d)&&d(a.item)}):a.items=b.all({},function(){angular.isFunction(d)&&d(a.items)})},a.updateItemImp=function(a,b,c,d){console.log("updating",c),b.update(c,function(a){console.log("updated",a),angular.isFunction(d)&&d(a)})},a.removeItemImp=function(a,b,c,d){if(confirm("Are You Sure???")&&(console.log("deleting",c),b.remove({id:c._id},function(){angular.isFunction(d)&&d(c)}),a.items&&a.items.length>0)){var e=a.items.findIndexById(c._id);a.items.splice(e,1)}},a.addItemImp=function(a,b,c,d){c?b.create(c,function(a){angular.isFunction(d)&&d(a)}):b.create(function(a){angular.isFunction(d)&&d(a)})},a.moveItemImp=function(b,c,d,e,f,g){if(f>0)var h=d.findNextById(e.pos,"pos");else if(0>f)var h=d.findPrevById(e.pos,"pos");if(e&&h){var i=e.pos;e.pos=h.pos,h.pos=i,a.updateItemImp(b,c,e,g),a.updateItemImp(b,c,h,g)}},b.clearForm=function(){$(".form-control").val("").text(""),a.filter={}},a.sort="name",a.sortBy=function(b){a.sort=b},a.isSortedBy=function(b){return a.sort==b},b.noimage="images/noimage.jpg",a.showUploader=!1,a.displayUploader=function(b){a.showUploader=b},b.elementTypes=g.all(),b.materials=h.all(),b.providers=k.all(),b.coatings=i.all(),b.elementFeatures=j.all(),b.currencies=l.all(),b.measureUnits=[{name:"גרם",_id:"gram"},{name:"סנטימטר",_id:"centimeter"},{name:"יחידה",_id:"unit"}],b.elementsCost=function(a,c,d){if(c&&c.length){var e=0;b.workCost=0,b.providerWorkCost=0,b.elementFeatureCost=0,b.coatingCost=0,b.materialCost=0;for(var f,g=0;f=c[g];g++){var h=(f.measureUnitWeight||0)/(1-(f.waste||0));if(b.materials){var i=b.materials.findById(f.material),j=(i.price||0)/Consts.OunceToGrams,k=d.findById(i._id);k&&k.newPrice&&(j=k.newPrice/Consts.OunceToGrams),b.materialCost+=h*f.amount*j}if(b.coatings){var l=b.coatings.findById(f.coating),m=l.measureUnit,n=l.price;"gram"==m?b.coatingCost+=h*f.amount*n:b.coatingCost+=f.amount*n||0}if(b.elementFeatures){var o=b.elementFeatures.findById(f.elementFeature),m=o.measureUnit,p=o.price||0;"gram"==m?b.elementFeatureCost+=h*f.amount*p:b.elementFeatureCost+=f.amount*p}var q=b.currencies.findById(f.workUnitCurrency),r=f.workUnitPrice*(q.conversion||0);k=d.findById(q._id),k&&k.newPrice&&(r=f.workUnitPrice*(k.newPrice||0));var s=f.workUnit;"gram"==s?b.providerWorkCost+=h*f.amount*r:b.providerWorkCost+=f.amount*r||0}var t=a.requiredTime||0,u=b.currencies.findById("TIME","code").conversion||0;return k=d.findById("TIME","code"),k&&k.newPrice&&(u=k.newPrice||0),b.workCost=(u||0)*t,b.workCost=Math.round(100*b.workCost)/100,b.providerWorkCost=Math.round(100*b.providerWorkCost)/100,b.elementFeatureCost=Math.round(100*b.elementFeatureCost)/100,b.coatingCost=Math.round(100*b.coatingCost)/100,b.materialCost=Math.round(100*b.materialCost)/100,e=b.workCost+b.providerWorkCost+b.elementFeatureCost+b.coatingCost+b.materialCost}}}]),angular.module("adminApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("adminApp").controller("PricesCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Prices",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("מטבעות","prices",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/prices")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/prices/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/prices/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("SettingsCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Settings",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c)},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/settings")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/settings/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/settings/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("OrdersCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Elements","Models","Orders",function(a,b,c,d,e,f,g,h){a.reloadItem=function(c){b.reloadItemImp(a,h,c,function(){a.parseModelsFromDb(),a.parsePricesFromDb(),a.updateBreadcrumbs("הזמנות","orders",a.item)})},a.updateItem=function(c){c.models=a.parseModelsToDb(),c.prices=a.parsePricesToDb(),b.updateItemImp(a,h,c)},a.removeItem=function(c){b.removeItemImp(a,h,c,function(){d.path("/orders")})},a.addItem=function(c){b.addItemImp(a,h,null,function(a){d.path("/orders/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,h,null,function(a){d.path("/orders/"+a._id)})},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id});var i=d.search().addId;b.filter={},a.removeModel=function(b){if(console.log("deleting",b),a.models&&a.models.length>0){var c=a.models.findIndexById(b._id);a.models.splice(c,1)}a.updateItem(a.item)},a.zeroModel=function(b){if(a.models&&a.models.length>0){var c=a.models.findIndexById(b._id);a.models[c].amount=0}a.updateItem(a.item)},a.parseModelsFromDb=function(){if(a.item){a.item.models||(a.item.models="[]");var b=JSON.parse(a.item.models);i&&b.push({id:i,amount:1}),a.models=[];for(var c,e=0;c=b[e];e++)g.query({id:c.id},function(c){c.amount=b.findById(c._id,"id").amount||0,a.models.push(c),i&&a.models.length==b.length&&(a.updateItem(a.item),i=!1,d.search({addId:null})),a.models.length==b.length&&a.getOrderElements()})}},a.parseModelsToDb=function(){if(a.item&&a.item.models){for(var b,c=[],d=0;b=a.models[d];d++)c.push({id:b._id,amount:b.amount});return a.item.models=JSON.stringify(c),a.item.models}},a.parsePricesFromDb=function(){if(a.item){a.item.prices||(a.item.prices="[]"),a.prices=[];for(var b,c=0;b=a.currencies[c];c++)b.newPrice=null,a.prices.push(b);for(var b,c=0;b=a.materials[c];c++)b.newPrice=null,a.prices.push(b);for(var b,d=JSON.parse(a.item.prices),c=0;b=d[c];c++)a.prices[a.prices.findIndexById(b.id)].newPrice=b.newPrice}},a.parsePricesToDb=function(){if(a.item&&a.item.prices){for(var b,c=[],d=0;b=a.prices[d];d++)b.newPrice&&c.push({id:b._id,newPrice:b.newPrice});return a.item.prices=JSON.stringify(c),a.item.prices}},a.getOrderElements=function(){if(a.models&&a.models.length){for(var b,c={},d=0;b=a.models[d];d++)for(var e,g=JSON.parse(b.elements),h=0;e=g[h];h++)c[e.id]||(c[e.id]=0),c[e.id]+=1;a.elements=[];for(var i in c)f.query({id:i},function(b){a.elements.push(b),a.elements.length==g.length&&a.orderCost()})}},a.updateOrderQuantities=function(){a.totalWorkTime=0;for(var b,c={},d=0;b=a.models[d];d++){a.totalWorkTime+=b.amount*(b.requiredTime||0);for(var e,f=JSON.parse(b.elements),g=0;e=f[g];g++)c[e.id]||(c[e.id]=0),c[e.id]+=b.amount*e.amount}for(var h in c){var e=a.elements.findIndexById(h);e>=0&&(a.elements[e].amount=c[h]||0)}},a.orderCost=function(){return!a.elements||!a.elements.length>0?void 0:(a.updateOrderQuantities(),a.elementsCost({requiredTime:a.totalWorkTime},a.elements,a.prices))}}]),angular.module("adminApp").controller("ModelsCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Elements","Models","Orders",function(a,b,c,d,e,f,g,h){a.reloadItem=function(c){b.reloadItemImp(a,g,c,function(){a.parseElementsFromDb(),a.parsePricesFromDb(),a.updateBreadcrumbs("דגמים","models",a.item)})},a.updateItem=function(c){c.name=a.item.modelType+a.item.modelId,c.elements=a.parseElementsToDb(),c.prices=a.parsePricesToDb(),b.updateItemImp(a,g,c)},a.removeItem=function(c){b.removeItemImp(a,g,c,function(){d.path("/models")})},a.addItem=function(c){b.addItemImp(a,g,null,function(a){d.path("/models/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,g,null,function(a){d.path("/models/"+a._id)})},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id});var i=d.search().addId;a.addTo=d.search().addTo,b.filter={},a.removeElement=function(b){if(console.log("deleting",b),a.elements&&a.elements.length>0){var c=a.elements.findIndexById(b._id);a.elements.splice(c,1)}a.updateItem(a.item)},a.zeroElement=function(b){if(a.elements&&a.elements.length>0){var c=a.elements.findIndexById(b._id);a.elements[c].amount=0}a.updateItem(a.item)},h.all(function(b){function c(a){for(var b,c=JSON.parse(a),d=[],e=0;b=c[e];e++)d.push(b.id);return d}a.orders=[];for(var d,e=0;d=b[e];e++)if(d.models){var f={name:d.name||d.desc},g=c(d.models);g.unshift(d._id),f._id=JSON.stringify(g),a.orders.push(f)}}),a.parseElementsFromDb=function(){if(a.item){a.item.elements||(a.item.elements="[]");var b=JSON.parse(a.item.elements);i&&b.push({id:i,amount:1}),a.elements=[];for(var c,e=0;c=b[e];e++)f.query({id:c.id},function(c){c.amount=b.findById(c._id,"id").amount||0,a.elements.push(c),i&&a.elements.length==b.length&&(a.updateItem(a.item),i=!1,d.search({addId:null})),a.elements.length==b.length&&a.modelCost()})}},a.parseElementsToDb=function(){if(a.item&&a.item.elements){for(var b,c=[],d=0;b=a.elements[d];d++)c.push({id:b._id,amount:b.amount});return a.item.elements=JSON.stringify(c),a.item.elements}},a.parsePricesFromDb=function(){if(a.item){a.item.prices||(a.item.prices="[]"),a.prices=[];for(var b,c=0;b=a.currencies[c];c++)b.newPrice=null,a.prices.push(b);for(var b,c=0;b=a.materials[c];c++)b.newPrice=null,a.prices.push(b);for(var b,d=JSON.parse(a.item.prices),c=0;b=d[c];c++)a.prices[a.prices.findIndexById(b.id)].newPrice=b.newPrice}},a.parsePricesToDb=function(){if(a.item&&a.item.prices){for(var b,c=[],d=0;b=a.prices[d];d++)b.newPrice&&c.push({id:b._id,newPrice:b.newPrice});return a.item.prices=JSON.stringify(c),a.item.prices}},a.modelCost=function(){return a.elements&&a.elements.length?a.elementsCost(a.item,a.elements,a.prices):void 0}}]),angular.module("adminApp").controller("ElementsCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Models","Elements",function(a,b,c,d,e,f,g){a.reloadItem=function(c){b.reloadItemImp(a,g,c,function(){a.updateBreadcrumbs("אלמנטים","elements",a.item)})},a.updateItem=function(c){b.updateItemImp(a,g,c)},a.removeItem=function(c){b.removeItemImp(a,g,c,function(){d.path("/elements")})},a.addItem=function(c){b.addItemImp(a,g,null,function(a){d.path("/elements/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,g,null,function(a){d.path("/elements/"+a._id)})},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id}),a.addTo=d.search().addTo,b.filter={},c.id||f.all(function(b){function c(a){for(var b,c=JSON.parse(a),d=[],e=0;b=c[e];e++)d.push(b.id);return d}a.models=[];for(var d,e=0;d=b[e];e++)if(d.elements){var f={name:d.modelCode||d.desc},g=c(d.elements);g.unshift(d._id),f._id=JSON.stringify(g),a.models.push(f)}}),a.duplicateForTest=function(){for(var b=1e6;a.items.length<b;)a.items=a.items.concat(a.items)}}]),angular.module("adminApp").controller("CoatingsCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Coatings",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("ציפויים","coatings",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/coatings")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/coatings/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/coatings/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("MaterialsCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Materials",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("חומרים","materials",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/materials")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/materials/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/materials/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("ProvidersCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","Providers",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("ספקים","providers",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/providers")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/providers/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/providers/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("ElementFeaturesCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","ElementFeatures",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("תכונות נוספות","elementFeatures",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/elementFeatures")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/elementFeatures/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/elementFeatures/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),angular.module("adminApp").controller("ElementTypesCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","ElementTypes",function(a,b,c,d,e,f){a.reloadItem=function(c){b.reloadItemImp(a,f,c,function(){a.updateBreadcrumbs("סוגי אלמנטים","elementTypes",a.item)})},a.updateItem=function(c){b.updateItemImp(a,f,c)},a.removeItem=function(c){b.removeItemImp(a,f,c,function(){d.path("/elementTypes")})},a.addItem=function(c){b.addItemImp(a,f,null,function(a){d.path("/elementTypes/"+a._id)})},a.duplicateItem=function(c){b.tempItem=c,b.addItemImp(a,f,null,function(a){d.path("/elementTypes/"+a._id)})},a.moveItemDown=function(c){b.moveItemImp(a,f,a.items,c,1)},a.moveItemUp=function(c){b.moveItemImp(a,f,a.items,c,-1)},b.tempItem?e(function(){a.item=b.tempItem,a.item._id=c.id,b.tempItem=null,e(function(){a.updateItem(a.item)})}):a.reloadItem({_id:c.id})}]),$.cloudinary.config().cloud_name="turkenich",$.cloudinary.config().upload_preset="hozspifg";var photoAlbumControllers=angular.module("adminApp");photoAlbumControllers.controller("photoUploadCtrlJQuery",["$scope","$rootScope","$routeParams","$location",function(a,b,c,d){a.files={},a.updateTitle=function(){var b=a.widget.fileupload("option","formData");b.context="photo="+a.title,a.widget.fileupload("option","formData",b)},a.widget=$(".cloudinary_fileupload").unsigned_cloudinary_upload($.cloudinary.config().upload_preset,{tags:"myphotoalbum",context:"photo="},{dropZone:"#direct_upload_jquery",start:function(b){a.status="Starting upload...",a.files={},a.$apply()},fail:function(b,c){a.status="Upload failed",a.$apply()}}).on("cloudinaryprogress",function(b,c){var d=c.files[0].name,e=a.files[d]||{};e.progress=Math.round(100*c.loaded/c.total),e.status="Uploading... "+e.progress+"%",a.files[d]=e,a.$apply()}).on("cloudinaryprogressall",function(b,c){a.progress=Math.round(100*c.loaded/c.total),a.status="Uploading... "+a.progress+"%",a.$apply()}).on("cloudinarydone",function(c,d){b.photos=b.photos||[],d.result.context={custom:{photo:a.title}},a.result=d.result;var e=d.files[0].name,f=a.files[e]||{};f.name=e,f.result=d.result,a.files[e]=f,b.photos.push(d.result),a.$apply()})}]).controller("photoUploadCtrl",["$scope","$rootScope","$routeParams","$location","$upload",function(a,b,c,d,e){function f(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}a.$watch("camera",function(c){if(c){var d=f(c);a.upload=e.upload({url:"https://api.cloudinary.com/v1_1/"+$.cloudinary.config().cloud_name+"/upload",
data:{upload_preset:$.cloudinary.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title},file:d}).progress(function(b){d.progress=Math.round(100*b.loaded/b.total),d.status="Uploading... "+d.progress+"%",a.$$phase||a.$apply()}).success(function(c,e,f,g){b.photos=b.photos||[],c.context={custom:{photo:a.title}},d.result=c,b.photos.push(c),a.$$phase||a.$apply()})}}),a.$watch("files",function(){a.files&&a.files.forEach(function(c){a.upload=e.upload({url:"https://api.cloudinary.com/v1_1/"+$.cloudinary.config().cloud_name+"/upload",data:{upload_preset:$.cloudinary.config().upload_preset,tags:"myphotoalbum",context:"photo="+a.title},file:c}).progress(function(b){c.progress=Math.round(100*b.loaded/b.total),c.status="Uploading... "+c.progress+"%",a.$$phase||a.$apply()}).success(function(d,e,f,g){b.photos=b.photos||[],d.context={custom:{photo:a.title}},c.result=d,b.photos.push(d),a.$$phase||a.$apply()})})}),a.dragOverClass=function(a){var b=a.dataTransfer.items,c=!1;if(null!=b){for(var d=0;d<b.length;d++)if("file"==b[d].kind){c=!0;break}}else c=!0;return c?"dragover":"dragover-err"}}]),angular.module("adminApp").factory("Prices",["$resource",function(a){return a(Consts.api_root+"prices/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Settings",["$resource",function(a){return a(Consts.api_root+"settings/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Orders",["$resource",function(a){return a(Consts.api_root+"orders/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Models",["$resource",function(a){return a(Consts.api_root+"models/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Elements",["$resource",function(a){return a(Consts.api_root+"elements/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("ElementTypes",["$resource",function(a){return a(Consts.api_root+"elementTypes/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Materials",["$resource",function(a){return a(Consts.api_root+"materials/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Coatings",["$resource",function(a){return a(Consts.api_root+"coatings/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("Providers",["$resource",function(a){return a(Consts.api_root+"providers/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").factory("ElementFeatures",["$resource",function(a){return a(Consts.api_root+"elementFeatures/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",params:{}},update:{method:"PUT",params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("adminApp").directive("itemActions",function(){return{template:'  <div class="btn-group" role="group" aria-label="..."><button class="btn btn-{{isDirty() ? \'primary\' : \'disabled\' }}" ng-click="updateItem(item); goBack(1000);"><i class="fa fa-check"></i> שמירה וסיום</button><button class="btn btn-{{isDirty() ? \'success\' : \'disabled\' }}" ng-click="duplicateItem(item)"><i class="fa fa-plus"></i> שמירה כחדש</button><button class="btn btn-{{isDirty() ? \'default\' : \'disabled\' }}" ng-click="reloadItem(item)"><i class="fa fa-undo"></i> ביטול</button><button class="btn btn-danger" ng-click="removeItem(item)"><i class="fa fa-trash"></i> מחיקה</button></div><div style="clear:both;"></div>',restrict:"E",link:function(a,b,c){a.isDirty=function(){return $(".ng-dirty").length>0}}}}),angular.module("adminApp").filter("listFilter",["$rootScope",function(a){return function(b){function c(a,b){for(var c in b){var d=b[c];if(c.indexOf("_")>0){var e=c.split("_"),f=e[0];if(e[1])var g=e[1]}else f=c;if(!a[f])return!1;if(angular.isArray(d)){if(-1==d.indexOf(a[f]))return!1}else if(angular.isObject(d)){if(angular.isObject(a[f])){if(d._id!=a[f]._id)return!1}else if(d._id!=a[f])return!1}else if(angular.isDate(d)){var h=new Date(d),i=new Date(a[f]);if("below"==g){if(i>h)return!1}else if("above"==g){if(h>i)return!1}else if(d&&h!=i)return!1}else if(angular.isNumber(d)){if("below"==g){if(d<a[f])return!1}else if("above"==g){if(d>a[f])return!1}else if(d&&d!=a[f])return!1}else if("string"==typeof a[f]&&"string"==typeof d){var j=new RegExp(d);if(!j.test(a[f]))return!1}}return!0}if(!(b.length<=0)){for(var d,e=a.filter,f=[],g=1e3,h=0;(d=b[h])&&!(f.length>g);h++)c(d,e)&&f.push(d);return f}}}]);